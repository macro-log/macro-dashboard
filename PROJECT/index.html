<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIGNAL 9 | Intelligence Dashboard</title>
    <style>
        :root {
            --bg-main: #0a0f1e;
            --bg-card: #161e31;
            --accent: #38bdf8;
            --text-main: #f1f5f9;
            --text-dim: #94a3b8;
            --border: #262f45;
        }

        body { font-family: 'Pretendard', sans-serif; margin: 0; background-color: var(--bg-main); color: var(--text-main); }
        header { padding: 15px 30px; background: var(--bg-card); display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border); }
        .logo { font-size: 1.6rem; font-weight: 800; color: var(--accent); }
        .main-layout { display: flex; flex-direction: column; padding: 20px; max-width: 1400px; margin: 0 auto; gap: 15px; }

        .nav-group { display: grid; grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); gap: 8px; }
        button { padding: 12px; cursor: pointer; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-dim); border-radius: 4px; font-weight: 700; font-size: 0.8rem; transition: 0.2s; }
        button:hover { background: var(--accent); color: var(--bg-main); }

        #ticker_container { height: 80px; background: var(--bg-card); border-radius: 8px; border: 1px solid var(--border); overflow: hidden; margin-bottom: 5px; }
        #chart_box { height: 600px; background: var(--bg-card); border-radius: 8px; overflow: hidden; border: 1px solid var(--border); }

        .analysis-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 10px; }
        .card { background: var(--bg-card); padding: 24px; border-radius: 8px; border: 1px solid var(--border); }
        .section-label { color: var(--accent); font-weight: 700; font-size: 0.7rem; text-transform: uppercase; margin-bottom: 10px; display: block; }
        
        /* 데이터 업데이트 시 깜빡이는 효과 */
        .updated { animation: highlight 1.5s ease; }
        @keyframes highlight {
            0% { background: var(--accent); color: var(--bg-main); }
            100% { background: var(--bg-card); color: var(--text-main); }
        }
    </style>
</head>
<body>

    <header>
        <div class="logo">SIGNAL 9</div>
        <div style="font-size: 0.8rem; color: var(--text-dim);">STRATEGIC DATA TERMINAL</div>
    </header>
    
    <div class="main-layout">
        <div class="nav-group">
            <button onclick="changeWidget('BINANCE:BTCUSDT')">비트코인</button>
            <button onclick="changeWidget('FOREXCOM:SPX500')">S&P 500</button>
            <button onclick="changeWidget('FOREXCOM:NAS100')">나스닥 100</button>
            <button onclick="changeWidget('FOREXCOM:DJI')">다우존스</button>
            <button onclick="changeWidget('US10Y')">미국 10년 국채</button>
            <button onclick="changeWidget('US02Y')">미국 2년 국채</button>
            <button onclick="changeWidget('TVC:GOLD')">금</button>
            <button onclick="changeWidget('TVC:USOIL')">유가</button>
        </div>

        <div id="ticker_container"></div>
        <div id="chart_box"></div>

        <div class="analysis-grid">
            <div class="card" id="scenario-card">
                <span class="section-label">Scenario Chain</span>
                <h3 id="chain-title">Market Impact Analysis</h3>
                <p id="chain-content" style="color: var(--text-dim); font-size: 0.95rem;">지표 분석 데이터를 불러오는 중...</p>
            </div>
            <div class="card" id="delta-card">
                <span class="section-label">Keyword Delta</span>
                <h3 id="word-title">Strategic Word Tracking</h3>
                <div id="word-content" style="color: var(--text-dim); font-size: 0.95rem; line-height: 1.6;">데이터 로드 대기 중...</div>
            </div>
        </div>
    </div>

    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    <script type="text/javascript">
        // 1. 차트 및 티커 로드 로직
        function loadTicker(symbol) {
            const container = document.getElementById('ticker_container');
            container.innerHTML = "";
            const script = document.createElement('script');
            script.src = "https://s3.tradingview.com/external-embedding/embed-widget-single-quote.js";
            script.async = true;
            script.innerHTML = JSON.stringify({
                "symbol": symbol,
                "width": "100%",
                "colorTheme": "dark",
                "isTransparent": true,
                "locale": "ko"
            });
            container.appendChild(script);
        }

        function loadChart(symbol) {
            document.getElementById('chart_box').innerHTML = "";
            new TradingView.widget({
                "width": "100%",
                "height": 600,
                "symbol": symbol,
                "interval": "D",
                "timezone": "Asia/Seoul",
                "theme": "dark",
                "style": "1",
                "locale": "ko",
                "toolbar_bg": "#f1f3f6",
                "enable_publishing": false,
                "allow_symbol_change": true,
                "container_id": "chart_box",
                "hide_side_toolbar": false,
                "withdateranges": true,
                "range": "ALL",
                "studies": [ "Volume@tv-basicstudies" ]
            });
        }

        function changeWidget(symbol) {
            loadTicker(symbol);
            loadChart(symbol);
        }

        // 2. [핵심] 파이썬 분석 데이터(JSON) 연동 로직
        async function updateAnalysisData() {
            try {
                // 파이썬 파일이 내뱉는 결과 파일 경로
                const response = await fetch('content/indicators.json'); 
                if (!response.ok) throw new Error('파일을 찾을 수 없습니다.');
                
                const data = await response.json();

                // Scenario Chain 업데이트
                if (data.scenario) {
                    const scenarioEl = document.getElementById('chain-content');
                    scenarioEl.innerText = data.scenario;
                    document.getElementById('scenario-card').classList.add('updated');
                    setTimeout(() => document.getElementById('scenario-card').classList.remove('updated'), 1500);
                }

                // Keyword Delta 업데이트
                const wordContentEl = document.getElementById('word-content');
                if (data.keywords && Array.isArray(data.keywords)) {
                    wordContentEl.innerHTML = data.keywords.map(k => 
                        `<div style="margin-bottom: 8px;">
                            <span style="color: var(--accent); font-weight: bold;">[${k.word}]</span> 
                            <span style="margin-left: 10px;">${k.delta}</span>
                        </div>`
                    ).join('');
                }
            } catch (error) {
                console.error("데이터 업데이트 실패:", error);
                document.getElementById('word-content').innerText = "데이터 파일(indicators.json)을 읽을 수 없습니다.";
            }
        }

        // 3. 페이지 시작 시 실행
        window.onload = function() { 
            changeWidget('BINANCE:BTCUSDT'); 
            updateAnalysisData(); // 첫 로딩
            setInterval(updateAnalysisData, 60000); // 1분마다 자동 갱신
        };
    </script>
</body>
</html>
